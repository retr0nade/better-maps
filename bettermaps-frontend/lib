import axios from 'axios'

export type NominatimSuggestion = {
  display_name: string
  lat: string
  lon: string
  type?: string
  boundingbox?: [string, string, string, string] | string[]
  address?: Record<string, unknown>
}

const client = axios.create({
  baseURL: 'https://nominatim.openstreetmap.org',
  headers: {
    // Identify your application per Nominatim usage policy
    'User-Agent': 'BetterMaps/1.0 (https://example.com/contact)',
    Accept: 'application/json',
  },
  timeout: 15000,
})

export async function nominatimSearch(query: string): Promise<NominatimSuggestion[]> {
  if (!query.trim()) return []
  const params = {
    q: query,
    format: 'json',
    addressdetails: '1',
    limit: '6',
  }
  const { data } = await client.get<NominatimSuggestion[]>('/search', { params })
  return data
}

export async function reverseGeocode(lat: number, lon: number): Promise<NominatimSuggestion | null> {
  const params = {
    lat: String(lat),
    lon: String(lon),
    format: 'json',
    addressdetails: '1',
  }
  const { data } = await client.get<NominatimSuggestion>('/reverse', { params })
  return data ?? null
}


